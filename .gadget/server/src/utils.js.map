{"version":3,"sources":["/app/packages/framework/src/utils.ts"],"sourcesContent":["// hacky copy of lodash utils we need for gadget-server that doesn't require us to have lodash available in gadget-server\n// we can't add it to all apps' node_modules, so we copy what we need over here\n// we plan to add a versioning scheme to gadget-server that will trigger a yarn install when the version changes, so when we have that, we can delete this and add a real dependency on lodash\nconst argsTag = \"[object Arguments]\",\n  arrayTag = \"[object Array]\",\n  asyncTag = \"[object AsyncFunction]\",\n  boolTag = \"[object Boolean]\",\n  dateTag = \"[object Date]\",\n  domExcTag = \"[object DOMException]\",\n  errorTag = \"[object Error]\",\n  funcTag = \"[object Function]\",\n  genTag = \"[object GeneratorFunction]\",\n  mapTag = \"[object Map]\",\n  numberTag = \"[object Number]\",\n  nullTag = \"[object Null]\",\n  objectTag = \"[object Object]\",\n  promiseTag = \"[object Promise]\",\n  proxyTag = \"[object Proxy]\",\n  regexpTag = \"[object RegExp]\",\n  setTag = \"[object Set]\",\n  stringTag = \"[object String]\",\n  symbolTag = \"[object Symbol]\",\n  undefinedTag = \"[object Undefined]\",\n  weakMapTag = \"[object WeakMap]\",\n  weakSetTag = \"[object WeakSet]\";\n\nconst symToStringTag = Symbol.toStringTag;\nconst nativeObjectToString = Object.prototype.toString;\nconst hasOwnProperty = Object.prototype.hasOwnProperty;\n\nfunction baseGetTag(value: any) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return symToStringTag && symToStringTag in Object(value) ? getRawTag(value) : nativeObjectToString.call(value);\n}\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value: any) {\n  const isOwn = hasOwnProperty.call(value, symToStringTag),\n    tag = value[symToStringTag];\n\n  let unmasked = false;\n  try {\n    value[symToStringTag] = undefined;\n    unmasked = true;\n  } catch (e) {\n    //\n  }\n\n  const result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nexport function assert<T>(value: T | false | undefined | null, message?: string): T {\n  if (!value) {\n    throw new Error(message ?? \"value is not truthy\");\n  }\n  return value;\n}\n\nexport function isObject(value: any) {\n  const type = typeof value;\n  return value != null && (type == \"object\" || type == \"function\");\n}\nexport function isObjectLike(value: any) {\n  return value != null && typeof value == \"object\";\n}\n\nexport function isFunction(value: any) {\n  if (!isObject(value)) {\n    return false;\n  }\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 9 which returns 'object' for typed arrays and other constructors.\n  const tag = baseGetTag(value);\n  return tag == funcTag || tag == genTag || tag == asyncTag || tag == proxyTag;\n}\n\nexport function isArrayLike(value: any) {\n  return value != null && typeof value.length == \"number\" && !isFunction(value);\n}\n\nexport function isEmpty(value: null | undefined | any[] | object) {\n  if (value == null) {\n    return true;\n  }\n  if (Array.isArray(value)) {\n    return !value.length;\n  }\n  const tag = baseGetTag(value);\n  if (tag == mapTag || tag == setTag) {\n    return !(value as Map<any, any> | Set<any>).size;\n  }\n  for (const key in value) {\n    if (hasOwnProperty.call(value, key)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function keyBy<T>(array: T[], iteratee: keyof T | ((value: T) => string)) {\n  return array.reduce<Record<string, T>>((result, value) => {\n    // check if iteratee is a function or a string\n    if (typeof iteratee === \"function\") {\n      result[iteratee(value)] = value;\n    } else if (typeof iteratee === \"string\") {\n      result[value[iteratee] as any] = value;\n    }\n    return result;\n  }, {});\n}\n\nexport function pickBy<T extends object>(object: T, predicate: (value: T[keyof T], key: keyof T) => boolean): Partial<T> {\n  const result: Partial<T> = {};\n\n  for (const key in object) {\n    if (hasOwnProperty.call(object, key) && predicate(object[key], key)) {\n      result[key] = object[key];\n    }\n  }\n\n  return result;\n}\n\nexport const defaults = (...args: any[]) => args.reverse().reduce((acc, obj) => ({ ...acc, ...obj }), {});\n"],"names":["assert","isObject","isObjectLike","isFunction","isArrayLike","isEmpty","keyBy","pickBy","defaults","argsTag","arrayTag","asyncTag","boolTag","dateTag","domExcTag","errorTag","funcTag","genTag","mapTag","numberTag","nullTag","objectTag","promiseTag","proxyTag","regexpTag","setTag","stringTag","symbolTag","undefinedTag","weakMapTag","weakSetTag","symToStringTag","Symbol","toStringTag","nativeObjectToString","Object","prototype","toString","hasOwnProperty","baseGetTag","value","undefined","getRawTag","call","isOwn","tag","unmasked","e","result","message","Error","type","length","Array","isArray","size","key","array","iteratee","reduce","object","predicate","args","reverse","acc","obj"],"mappings":"AAAA,yHAAyH;AACzH,+EAA+E;AAC/E,8LAA8L;;;;;;;;;;;;IAiE9KA,MAAM,MAANA;IAOAC,QAAQ,MAARA;IAIAC,YAAY,MAAZA;IAIAC,UAAU,MAAVA;IAUAC,WAAW,MAAXA;IAIAC,OAAO,MAAPA;IAmBAC,KAAK,MAALA;IAYAC,MAAM,MAANA;IAYHC,QAAQ,MAARA;;AAxIb,MAAMC,UAAU,sBACdC,WAAW,kBACXC,WAAW,0BACXC,UAAU,oBACVC,UAAU,iBACVC,YAAY,yBACZC,WAAW,kBACXC,UAAU,qBACVC,SAAS,8BACTC,SAAS,gBACTC,YAAY,mBACZC,UAAU,iBACVC,YAAY,mBACZC,aAAa,oBACbC,WAAW,kBACXC,YAAY,mBACZC,SAAS,gBACTC,YAAY,mBACZC,YAAY,mBACZC,eAAe,sBACfC,aAAa,oBACbC,aAAa;AAEf,MAAMC,iBAAiBC,OAAOC,WAAW;AACzC,MAAMC,uBAAuBC,OAAOC,SAAS,CAACC,QAAQ;AACtD,MAAMC,iBAAiBH,OAAOC,SAAS,CAACE,cAAc;AAEtD,SAASC,WAAWC,KAAU,EAAE;IAC9B,IAAIA,SAAS,IAAI,EAAE;QACjB,OAAOA,UAAUC,YAAYb,eAAeR,OAAO;IACrD,CAAC;IACD,OAAOW,kBAAkBA,kBAAkBI,OAAOK,SAASE,UAAUF,SAASN,qBAAqBS,IAAI,CAACH,MAAM;AAChH;AAEA;;;;;;CAMC,GACD,SAASE,UAAUF,KAAU,EAAE;IAC7B,MAAMI,QAAQN,eAAeK,IAAI,CAACH,OAAOT,iBACvCc,MAAML,KAAK,CAACT,eAAe;IAE7B,IAAIe,WAAW,KAAK;IACpB,IAAI;QACFN,KAAK,CAACT,eAAe,GAAGU;QACxBK,WAAW,IAAI;IACjB,EAAE,OAAOC,GAAG;IACV,EAAE;IACJ;IAEA,MAAMC,SAASd,qBAAqBS,IAAI,CAACH;IACzC,IAAIM,UAAU;QACZ,IAAIF,OAAO;YACTJ,KAAK,CAACT,eAAe,GAAGc;QAC1B,OAAO;YACL,OAAOL,KAAK,CAACT,eAAe;QAC9B,CAAC;IACH,CAAC;IACD,OAAOiB;AACT;AAEO,SAAShD,OAAUwC,KAAmC,EAAES,OAAgB,EAAK;IAClF,IAAI,CAACT,OAAO;QACV,MAAM,IAAIU,MAAMD,WAAW,uBAAuB;IACpD,CAAC;IACD,OAAOT;AACT;AAEO,SAASvC,SAASuC,KAAU,EAAE;IACnC,MAAMW,OAAO,OAAOX;IACpB,OAAOA,SAAS,IAAI,IAAKW,CAAAA,QAAQ,YAAYA,QAAQ,UAAS;AAChE;AACO,SAASjD,aAAasC,KAAU,EAAE;IACvC,OAAOA,SAAS,IAAI,IAAI,OAAOA,SAAS;AAC1C;AAEO,SAASrC,WAAWqC,KAAU,EAAE;IACrC,IAAI,CAACvC,SAASuC,QAAQ;QACpB,OAAO,KAAK;IACd,CAAC;IACD,wEAAwE;IACxE,8EAA8E;IAC9E,MAAMK,MAAMN,WAAWC;IACvB,OAAOK,OAAO7B,WAAW6B,OAAO5B,UAAU4B,OAAOlC,YAAYkC,OAAOtB;AACtE;AAEO,SAASnB,YAAYoC,KAAU,EAAE;IACtC,OAAOA,SAAS,IAAI,IAAI,OAAOA,MAAMY,MAAM,IAAI,YAAY,CAACjD,WAAWqC;AACzE;AAEO,SAASnC,QAAQmC,KAAwC,EAAE;IAChE,IAAIA,SAAS,IAAI,EAAE;QACjB,OAAO,IAAI;IACb,CAAC;IACD,IAAIa,MAAMC,OAAO,CAACd,QAAQ;QACxB,OAAO,CAACA,MAAMY,MAAM;IACtB,CAAC;IACD,MAAMP,MAAMN,WAAWC;IACvB,IAAIK,OAAO3B,UAAU2B,OAAOpB,QAAQ;QAClC,OAAO,CAAC,AAACe,MAAmCe,IAAI;IAClD,CAAC;IACD,IAAK,MAAMC,OAAOhB,MAAO;QACvB,IAAIF,eAAeK,IAAI,CAACH,OAAOgB,MAAM;YACnC,OAAO,KAAK;QACd,CAAC;IACH;IACA,OAAO,IAAI;AACb;AAEO,SAASlD,MAASmD,KAAU,EAAEC,QAA0C,EAAE;IAC/E,OAAOD,MAAME,MAAM,CAAoB,CAACX,QAAQR,QAAU;QACxD,8CAA8C;QAC9C,IAAI,OAAOkB,aAAa,YAAY;YAClCV,MAAM,CAACU,SAASlB,OAAO,GAAGA;QAC5B,OAAO,IAAI,OAAOkB,aAAa,UAAU;YACvCV,MAAM,CAACR,KAAK,CAACkB,SAAS,CAAQ,GAAGlB;QACnC,CAAC;QACD,OAAOQ;IACT,GAAG,CAAC;AACN;AAEO,SAASzC,OAAyBqD,MAAS,EAAEC,SAAuD,EAAc;IACvH,MAAMb,SAAqB,CAAC;IAE5B,IAAK,MAAMQ,OAAOI,OAAQ;QACxB,IAAItB,eAAeK,IAAI,CAACiB,QAAQJ,QAAQK,UAAUD,MAAM,CAACJ,IAAI,EAAEA,MAAM;YACnER,MAAM,CAACQ,IAAI,GAAGI,MAAM,CAACJ,IAAI;QAC3B,CAAC;IACH;IAEA,OAAOR;AACT;AAEO,MAAMxC,WAAW,CAAC,GAAGsD,OAAgBA,KAAKC,OAAO,GAAGJ,MAAM,CAAC,CAACK,KAAKC,MAAS,CAAA;YAAE,GAAGD,GAAG;YAAE,GAAGC,GAAG;QAAC,CAAA,GAAI,CAAC"}